diff --git a/ms/winrt.cpp b/ms/winrt.cpp
index 4dcc8aa..dd754ba 100644
--- a/ms/winrt.cpp
+++ b/ms/winrt.cpp
@@ -136,6 +136,7 @@ int RAND_poll(void)
 }
 
 #if defined(OPENSSL_WINAPP)
+#include<string>
 extern "C"
 {
 #include<stdio.h>
@@ -259,11 +259,24 @@ extern "C"
                       const char *varname
                       )
         {
+		static std::string cert_path;
         //hardcoded environmental variables used for the appx testing application for store/phone
         if (!strcmp(varname, "OPENSSL_CONF"))
             {
             return "./openssl.cnf";
             }
+		if (!strcmp(varname, "SSL_CERT_FILE"))
+		{
+			uint32_t varSize = GetEnvironmentVariableA(varname, nullptr, 0);
+			if (varSize <= 0)
+				return nullptr; // Not found
+
+			std::string value(varSize, 0);
+			GetEnvironmentVariableA(varname, const_cast<char*>(value.c_str()), varSize);
+
+			cert_path = value;
+			return const_cast<char*>(cert_path.c_str());
+		}
         return 0;
         }
     int winrt_setenv(const char *envname, const char *envval, int overwrite)
diff --git a/util/mk1mf.pl b/util/mk1mf.pl
index ff7aa774491..a5fb3986927 100755
--- a/util/mk1mf.pl
+++ b/util/mk1mf.pl
@@ -754,13 +754,13 @@ sub fix_asm
 if ($platform eq "VC-WINPHONE" or $platform eq "VC-WINSTORE") {
     $rules.= <<"EOF";
 \$(OBJ_D)\\winrt.obj: \$(SRC_D)\\ms\\winrt.cpp
-	\$(CC) /Fo\$(OBJ_D)\\winrt.obj \$(LIB_CFLAGS) -c \$(SRC_D)\\ms\\winrt.cpp
+	\$(CC) /EHsc /Fo\$(OBJ_D)\\winrt.obj \$(LIB_CFLAGS) -c \$(SRC_D)\\ms\\winrt.cpp
 
 EOF
 } elsif($platform eq "VC-WINUNIVERSAL") {
     $rules.= <<"EOF";
 \$(OBJ_D)\\winrt.obj: \$(SRC_D)\\ms\\winrt.cpp
-	\$(CC) /Fo\$(OBJ_D)\\winrt.obj \$(LIB_CFLAGS) -c \$(SRC_D)\\ms\\winrt.cpp
+	\$(CC) /EHsc /Fo\$(OBJ_D)\\winrt.obj \$(LIB_CFLAGS) -c \$(SRC_D)\\ms\\winrt.cpp
 
 EOF
 }-- 
2.14.1.windows.1

